# GOST V3 入门系列（六）：访问控制与安全（把“能用”变成“敢用”）

> 本篇目标：让新人建立最关键的安全意识与操作习惯，能把一个“跑起来的 gost”收敛成“不会随便暴露、不会被滥用、出问题能追踪”的可控服务。
>
> 严谨性声明：
>
> - 本篇会把**确定的通用安全原则**讲清楚（这些不依赖某个参数名）。
> - 任何涉及“具体协议支持/具体配置字段/具体参数”的部分，如果我不能 100% 确认与你们正在用的 V3 Release 完全一致，我会用“**如何用 `gost -h/--help` 与官方文档确认**”的方式写法，而不是硬写结论。

---

## 0. 先讲结论：安全不是“加个密码”这么简单

把 gost 当成一个“网络入口”，你需要同时解决三类问题：

1. **暴露面（Exposure）**：到底谁能连到你的入站端口？（绑定地址、开放端口、防火墙）
2. **身份与准入（Identity & Admission）**：连到的人有没有权限使用？（认证、白名单、拒绝规则）
3. **可追踪性（Observability）**：出问题/被滥用时，你有没有证据？（日志、运行方式、最小留存）

新手最常见的事故路径是：

> “为了方便测试，把监听写成 `:1080` 或 `0.0.0.0:1080` → 端口对外开放 → 没有认证/准入 → 被扫描到并滥用”

本篇就是为了让你避开这条路。

---

## 1. 威胁模型：先问 5 个问题（你才能知道该防什么）

你不需要一上来就懂安全框架，只要能回答这些问题：

1. **这个入站端口会不会被公网访问到？**  
   - 如果会：你必须做认证/准入，且要有防火墙与最小暴露面。
2. **这个端口被别人用会有什么后果？**  
   - 例如：带宽被跑满、IP 被封、合规风险、内网被探测等。
3. **服务需要给谁用？**  
   - 只给自己：强烈建议只监听 `127.0.0.1`。  
   - 给同网段同事：建议只绑定到内网 IP + 防火墙限制来源。
4. **你能否接受“被扫到就能用”？**  
   - 不能接受就必须上认证/准入（别侥幸）。
5. **出了问题谁来排？靠什么证据排？**  
   - 没日志/没版本号/没启动命令记录，排障会非常痛苦。

---

## 2. 第一道防线：绑定地址（把入口“开在正确的墙上”）

这条是最确定、也最有效的原则：**能不对外开，就别对外开。**

### 2.1 三种常见绑定方式（新手只要记住安全排序）

- `127.0.0.1:PORT`：只本机可连（✅ 最安全，学习/开发首选）
- `内网IP:PORT`：只对某张网卡/某个网段可见（⚠️ 需要你理解网络边界）
- `0.0.0.0:PORT` 或 `:PORT`：所有网卡都监听（❌ 最危险，除非你明确要对外服务）

> 你可以把它想象成开店：  
> `127.0.0.1` = 只在家里招待自己；`内网IP` = 只对小区开放；`0.0.0.0` = 把店开到临街，路过都能进。

### 2.2 你如何确认自己有没有“误对外暴露”

启动后立刻查监听：

- Windows（PowerShell）：

```powershell
netstat -ano | findstr :1080
```

- Linux/macOS：

```bash
ss -lntp | grep 1080 || netstat -an | grep 1080
```

看到 `0.0.0.0` 或 `::`（IPv6 全网卡）就要警惕：这通常意味着对外可见。

---

## 3. 第二道防线：防火墙/安全组（就算程序监听了，也不让别人连）

> 这部分属于通用系统能力，与 gost 本身无关，因此我们可以写得确定。

### 3.1 本机学习：通常不需要开防火墙端口

如果你只监听 `127.0.0.1`，外部根本连不到，防火墙规则不是必须项。

### 3.2 服务器/内网共享：必须限制来源

原则：

- **只开放必要端口**（别为了省事开一堆）
- **只允许必要来源 IP/网段**（能白名单就白名单）

Windows 与 Linux 的具体防火墙命令写法因环境差异很大（公司镜像、安全基线也会不同），建议按你们内部标准操作流程来做。

---

## 4. 第三道防线：认证（Authentication）与准入（Admission）

### 4.1 先区分两个概念：认证 vs 准入

- **认证（Authentication）**：你是谁？（用户名/密码/令牌等）
- **准入（Admission）**：就算你是谁，你能不能用？（白名单、规则、策略）

类比：

- 认证像“刷工牌”
- 准入像“这个楼层你有没有权限进”

### 4.2 怎么确认你当前 V3 支持哪些认证方式？

不要看第三方教程，直接用你手里的二进制确认：

1. 运行 `gost -h` / `gost --help`
2. 找入站（通常是 `-L`）的 URL 格式说明
3. 找是否提到用户名/密码写法、或是否有相关参数

### 4.3 一个“最小可用”的思路（以你们环境可用为准）

在本系列第二篇我们展示过“在 URL 里带用户名密码”的写法（例如 `scheme://user:pass@:port`）。  
是否在你们的 V3 Release 中对所有入站都成立，需要你用下列方式验证：

- 启动是否报错
- 客户端不带凭据访问是否被拒绝
- 客户端带凭据访问是否成功

如果三步都符合，才把它写进你们的内部“标准模板”里。

---

## 5. 最小暴露面清单（新人按这个做，基本不会出大事）

你可以把它当成“上线前必过 checklist”：

- **监听地址**：默认 `127.0.0.1`；必须对外时才用内网 IP/`0.0.0.0`
- **端口开放**：只开必要端口；服务器上配安全组/防火墙限制来源
- **认证/准入**：只要对外提供入站，就必须做（别裸奔）
- **运行方式**：后台运行要能看到日志（别把日志全丢了）
- **版本记录**：记录你用的 V3 Release 版本号（排障/回归必需）

---

## 6. 日志与可追踪性：出问题时你靠什么定位？

### 6.1 最小原则

- **能复现**：保留启动命令/配置文件
- **能定位**：保留必要日志（至少包含错误信息与连接事件）

### 6.2 新手最常见的“无法定位”原因

- 不知道自己跑的是哪个版本
- 不知道自己用了什么启动参数
- 端口对外开放了但没任何访问日志

解决办法很朴素：把这些信息写进你们的文档模板或启动脚本里。

---

## 7.（可选）把“安全默认值”做成团队规范

如果你们要给新人一个“复制就不会错”的默认模板，我建议至少固定三条：

1. **默认只绑定 `127.0.0.1`**（除非明确写“对外服务”）
2. **任何对外端口必须有认证/准入 + 防火墙限制来源**
3. **启动必须可追踪**：版本号、启动命令/配置、日志路径

---

## 8. 本篇小结

你读完本篇，应该能做到：

1. 一眼判断一个入站是否“可能对外暴露”
2. 解释清楚：认证与准入的区别
3. 知道遇到“V3 到底支不支持某种安全能力”时，如何用 `gost -h` 与官方文档得到确定答案
4. 用最小暴露面 checklist 把一个可用服务收敛成可控服务

